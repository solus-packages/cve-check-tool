From c129befc93b4fd3a6cfeb5518376910db839e688 Mon Sep 17 00:00:00 2001
From: Joey Riches <josephriches@gmail.com>
Date: Wed, 10 Nov 2021 11:59:17 +0000
Subject: [PATCH 2/3] Point release to tmp pointer and get rid of
 release_string

Casting tmp to release_string was causing it to segfault with some repos.
Just use tmp instead as it does what we want.

This should be cleaned up properly at some point.
---
 src/plugins/packaging/eopkg/eopkg.c | 4 +---
 1 file changed, 1 insertion(+), 3 deletions(-)

diff --git a/src/plugins/packaging/eopkg/eopkg.c b/src/plugins/packaging/eopkg/eopkg.c
index 78082c2..350bb3a 100644
--- a/src/plugins/packaging/eopkg/eopkg.c
+++ b/src/plugins/packaging/eopkg/eopkg.c
@@ -34,7 +34,6 @@ struct source_package_t *eopkg_inspect_pspec(const char *filename)
 
         xmlChar *source_name = NULL;
         int release = -1;
-        xmlChar release_string = NULL;
         xmlChar *version = NULL;
         char *fpath = NULL;
 
@@ -85,7 +84,6 @@ struct source_package_t *eopkg_inspect_pspec(const char *filename)
                                         continue;
                                 }
                                 int t_release = atoi((const char *)tmp);
-                                release_string = tmp;
                                 if (t_release > release) {
                                         release = t_release;
                                         if (version) {
@@ -123,7 +121,7 @@ struct source_package_t *eopkg_inspect_pspec(const char *filename)
         }
         t->name = xmlStrdup(source_name);
         t->version = xmlStrdup(version);
-        t->release = (release_string != NULL) ? xmlStrdup(release_string) : NULL;
+        t->release = xmlStrdup(tmp);
         t->path = fpath;
         t->xml = true; /* Ensure xmlFree is used */
         t->type = PACKAGE_TYPE_EOPKG;
-- 
2.33.1

