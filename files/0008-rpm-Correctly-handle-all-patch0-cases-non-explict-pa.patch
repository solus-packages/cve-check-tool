From 95214d0ec22c3e2c7224e525a4b456eae227ff99 Mon Sep 17 00:00:00 2001
From: Ikey Doherty <michael.i.doherty@intel.com>
Date: Thu, 16 Jul 2015 17:21:12 +0100
Subject: [PATCH 08/13] rpm: Correctly handle all %patch0 cases (non-explict
 patch id)

Signed-off-by: Ikey Doherty <michael.i.doherty@intel.com>
---
 src/packaging/rpm.c | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/src/packaging/rpm.c b/src/packaging/rpm.c
index d09182d..d05d81e 100644
--- a/src/packaging/rpm.c
+++ b/src/packaging/rpm.c
@@ -181,11 +181,16 @@ struct source_package_t *rpm_inspect_spec(const char *filename)
                                 goto clean;
                         }
                         if (g_strv_length(splits) == 1 || !splits[1] || g_str_equal(splits[1], "")) {
-                                key = "0";
+                                g_free(key);
+                                key = g_strdup("0");
                         } else {
                                 key = splits[1];
                         }
-                        key = firstword(key);
+                        key = g_strchomp(firstword(key));
+                        if (g_str_equal(key, "")) {
+                                g_free(key);
+                                key = g_strdup("0");
+                        }
                         val = g_hash_table_lookup(patches, key);
                         if (!val) {
                                 fprintf(stderr, "%s is broken - applying \"patch%s\" which isn't declared\n", filename, key);
-- 
2.4.6

